document.addEventListener("DOMContentLoaded",function(){const n=document.getElementById("category_id"),t=document.getElementById("subcategory_id");if(!n||!t)return;const r=n.value||window.oldCategoryId||null,d=window.oldSubcategoryId||null;n.addEventListener("change",function(){const c=this.value;t.innerHTML='<option value="">اختر الفئة الفرعية</option>',t.disabled=!0,c&&fetch(`/admin/inventory/categories/${c}/subcategories`,{method:"GET",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"}}).then(e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()}).then(e=>{t.innerHTML='<option value="">اختر الفئة الفرعية</option>',e&&Array.isArray(e)&&e.length>0?(e.forEach(i=>{const o=document.createElement("option");o.value=i.id,o.textContent=i.name,d&&i.id==d&&(o.selected=!0),t.appendChild(o)}),t.disabled=!1):t.innerHTML='<option value="">لا توجد فئات فرعية</option>'}).catch(e=>{console.error("Error loading subcategories:",e),t.innerHTML='<option value="">حدث خطأ في تحميل الفئات الفرعية</option>'})}),r&&n.value===r&&n.dispatchEvent(new Event("change"))});
