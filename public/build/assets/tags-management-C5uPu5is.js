document.addEventListener("DOMContentLoaded",function(){const a=document.querySelector("#tags");if(!a||typeof Choices>"u")return;const n=new Choices(a,{removeItemButton:!0,searchEnabled:!0,placeholder:!0,placeholderValue:"اختر التاغات أو اكتب لإضافة جديد",searchPlaceholderValue:"ابحث عن تاغ أو اكتب لإضافة جديد",addItems:!0,editItems:!1,duplicateItemsAllowed:!1}),r=new Set;n.passedElement.element.addEventListener("addItem",function(s){const t=s.detail.value;isNaN(t)&&fetch("/admin/tags/check-duplicate",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",Accept:"application/json"},body:JSON.stringify({name:t})}).then(e=>e.json()).then(e=>{e.exists&&e.tag?(n.removeActiveItemsByValue(t),n.setChoiceByValue(e.tag.id.toString())):r.add(t)}).catch(e=>{console.error("Error checking tag:",e)})});const c=a.closest("form");c&&c.addEventListener("submit",function(s){if(r.size===0)return;s.preventDefault();const t=Array.from(r).map(e=>fetch("/admin/tags",{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]')?.getAttribute("content")||"",Accept:"application/json"},body:JSON.stringify({name:e})}).then(o=>o.json()).then(o=>{if(o.tag)return n.removeActiveItemsByValue(e),n.setChoiceByValue(o.tag.id.toString()),o.tag.id;throw new Error("Failed to create tag")}));Promise.all(t).then(()=>{r.clear(),c.submit()}).catch(e=>{console.error("Error creating tags:",e),alert("حدث خطأ أثناء إنشاء التاغات الجديدة. يرجى المحاولة مرة أخرى.")})})});
