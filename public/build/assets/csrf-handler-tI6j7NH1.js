(function(){function c(){const e=document.querySelector('meta[name="csrf-token"]');return e?e.getAttribute("content"):null}function i(e){document.querySelectorAll("form").forEach(d=>{const s=d.querySelector('input[name="_token"]');s&&(s.value=e)});const n=document.querySelector('meta[name="csrf-token"]');n&&n.setAttribute("content",e)}function o(){return fetch("/refresh-csrf-token",{method:"GET",headers:{Accept:"application/json","X-Requested-With":"XMLHttpRequest"},credentials:"same-origin"}).then(e=>{if(e.ok)return e.json();throw new Error("Failed to refresh CSRF token")}).then(e=>{if(e.token)return i(e.token),console.log("CSRF token refreshed successfully"),e.token;throw new Error("No token in response")}).catch(e=>{console.error("Error refreshing CSRF token:",e),window.location.reload()})}const u=window.fetch;window.fetch=function(...e){return u.apply(this,e).then(t=>t.status===419?o().then(n=>(e[1]||(e[1]={}),e[1].headers||(e[1].headers={}),e[1].headers instanceof Headers?e[1].headers.set("X-CSRF-TOKEN",n):typeof e[1].headers=="object"&&(e[1].headers["X-CSRF-TOKEN"]=n),u.apply(this,e))):t).catch(t=>{throw console.error("Fetch error:",t),t})},document.addEventListener("submit",function(e){const t=e.target;if(t.tagName==="FORM"&&(new FormData(t).get("_method")||t.method||"GET").toUpperCase()!=="GET"&&!t.querySelector('input[name="_token"]')){const f=c();if(f){const r=document.createElement("input");r.type="hidden",r.name="_token",r.value=f,t.appendChild(r)}}},!0),setInterval(o,1800*1e3),document.addEventListener("visibilitychange",function(){document.hidden||o()}),window.addEventListener("focus",o),document.readyState==="loading"?document.addEventListener("DOMContentLoaded",function(){i(c())}):i(c())})();
